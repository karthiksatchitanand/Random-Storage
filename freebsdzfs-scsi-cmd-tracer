ZFS is a popular filesystem, mostly used as a storage-engine/volume-manager on solaris or freebsd.
There are many effective, low-cost storage solutions built around this combination. Cloudbyte's "ElastiStor"
is one such product. You can find out more about it here : http://www.docs.cloudbyte.com/cloudbyte-elastistor-overview/

I was interested in understanding the scsi commands generated by the freebsd cam layer upon executing some
common freebsd/zfs functions, performed as part of configuration, health-checks etc.., by various services in the
elastistor OS (We can use camcontrol debug to help us get this trace)

Setup: dell R720 server connected to a dell MD1200 disk enclosure (henceforth we will refer to this arrangement as ES appliance)

Startup:
-------

Boot ES appliance                       inquiry, report luns, mode sense(6), read capacity, test unit ready

Configuration:
-------------

zpool create/destroy                    write(6), read(6), write(10), read(10), synchronize cache
zpool import/export                     write(6), read(6), write(10), read(10)
zfs snapshot, send/receive              write(6), read(6), write(10), read(10), synchronize cache
zfs replace(resilver)                   inquiry, write(6), read(6), write(10), read(10), synchronize cache

Health-check, monitor, HA:
-------------------------

camcontrol modepage <da> -m <pg>        mode sense(6)
sg_vpd --page=ei --long <da>            inquiry
sg_persist -i, -r                       persistent reserve in(5e 00, 5e 01)
sg_persist --register, reserve, clear   persistent reserve out, inquiry
gmultipath refresh                      read(10)
